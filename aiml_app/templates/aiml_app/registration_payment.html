{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Registration Step {{ wizard.steps.step1|add:"1" }}</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h2>Step {{ wizard.steps.step1|add:"1" }}: Registration & Payment</h2>

    <form method="post" action="">
        {% csrf_token %}
        {{ wizard.management_form }}

        <h4>Registration Type</h4>
        {{ wizard.form.registration_type.label_tag }} {{ wizard.form.registration_type }}

        <h4>Payment Option</h4>
        {{ wizard.form.payment_option.label_tag }} {{ wizard.form.payment_option }}

        <div id="credit_card_fields">
            {{ wizard.form.card_number.label_tag }} {{ wizard.form.card_number }}
            {{ wizard.form.expiry_date.label_tag }} {{ wizard.form.expiry_date }}
            {{ wizard.form.cvv.label_tag }} {{ wizard.form.cvv }}
        </div>

        <h4>Registration Fee</h4>
        {{ wizard.form.registration_fee }}

        <div class="mt-3">
            {% if wizard.steps.prev %}
                <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}" class="btn btn-secondary">Back</button>
            {% endif %}
            <button type="submit" class="btn btn-success">Submit</button>
        </div>
    </form>
</div>

<script>
    const REGISTRATION_PRICES = {{ REGISTRATION_PRICES|safe }};
    
    $(document).ready(function(){
        $('#id_registration_type').change(function(){
            let regType = $(this).val();
            if (REGISTRATION_PRICES[regType] !== undefined){
                $('#id_registration_fee').val(REGISTRATION_PRICES[regType]);
            } else {
                $('#id_registration_fee').val('');
            }
        });

        // Trigger on page load
        $('#id_registration_type').trigger('change');
    });
</script>
</body>
</html>
