{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2>Payment</h2>
    <p>You will be charged <strong>${{ amount }}</strong> for your registration.</p>

    <form id="payment-form">
        <div id="card-element" class="form-control mb-3"></div>
        <div id="card-errors" class="text-danger mb-3" role="alert"></div>
        <button id="submit" class="btn btn-success">Pay Now</button>
    </form>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("{{ stripe_public_key }}");
    const elements = stripe.elements();
    const card = elements.create("card");
    card.mount("#card-element");

    const form = document.getElementById("payment-form");
    form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const {paymentIntent, error} = await stripe.confirmCardPayment(
            "{{ client_secret }}",
            { payment_method: { card: card } }
        );
        if (error) {
            document.getElementById("card-errors").textContent = error.message;
        } else {
            window.location.href = "{% url 'registration_success' %}";
        }
    });
</script>
{% endblock %}
